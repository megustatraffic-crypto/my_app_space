<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Cosmic Farm</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&display=swap" rel="stylesheet">

<style>
/* --- Ğ¡Ğ¢Ğ˜Ğ›Ğ˜ ĞĞ¡Ğ¢ĞĞ®Ğ¢Ğ¡Ğ¯ Ğ¢Ğ• Ğ–Ğ• (Ğ½Ğµ Ğ¼ĞµĞ½ÑĞµĞ¼) --- */
body {
  margin:0; padding:0;
  font-family:'Orbitron', sans-serif;
  background:#000814; color:white;
  overflow:hidden;
}
#app { width:100vw; height:100vh; display:flex; flex-direction:column; align-items:center; padding-top:20px; }
.header { text-align:center; }
.header h1 { margin:0; }
.menu { display:grid; grid-template-columns:repeat(3,100px); grid-gap:10px; margin-top:10px; }
.menu-btn { width:100px; height:100px; background:#001d3d; border:2px solid #00c9ff; border-radius:12px; display:flex; align-items:center; justify-content:center; cursor:pointer; }
.menu-btn:hover { background:#003566; transform:scale(1.05); }
.panel { width:100%; height:58vh; background:#001d3d; border:2px solid #00c9ff; border-radius:10px; margin-top:15px; padding:15px; overflow-y:auto;}
.hidden { display:none; }
.farm-grid { display:grid; grid-template-columns:repeat(3,90px); grid-gap:12px; justify-content:center; margin-top:15px; }
.tile { width:90px; height:90px; border:2px solid #00c9ff; border-radius:10px; display:flex; align-items:center; justify-content:center; cursor:pointer; }
.tile:hover { transform:scale(1.08); border-color:#61efff; }
</style>
</head>

<body>
<div id="app">

  <div class="header">
    <h1>ğŸŒŒ COSMIC FARM</h1>
    <div id="user_bar">Frags: 0</div>
  </div>

  <div class="menu">
    <div class="menu-btn" onclick="openPanel('farm')">ğŸŒ± Farm</div>
    <div class="menu-btn" onclick="openPanel('shop')">ğŸ›’ Shop</div>
    <div class="menu-btn" onclick="openPanel('inv')">ğŸ’ Inventory</div>
    <div class="menu-btn" onclick="openPanel('quests')">ğŸš€ Quests</div>
    <div class="menu-btn" onclick="openPanel('profile')">ğŸ‘¤ Profile</div>
    <div class="menu-btn" onclick="openPanel('tutorial')">â“ Help</div>
  </div>

  <div id="panel_farm" class="panel hidden">
    <h2>ğŸŒ± Your Farm</h2>
    <div id="status_bar"></div>
    <div class="farm-grid" id="farm_grid"></div>
  </div>

  <div id="panel_shop" class="panel hidden"><h2>ğŸ›’ Shop</h2></div>
  <div id="panel_inv" class="panel hidden"><h2>ğŸ’ Inventory</h2></div>
  <div id="panel_quests" class="panel hidden"><h2>ğŸš€ Quests</h2></div>
  <div id="panel_profile" class="panel hidden"><h2>ğŸ‘¤ Profile</h2></div>
  <div id="panel_tutorial" class="panel hidden"><h2>â“ Help</h2></div>

</div>

<script>
// âœ… Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Telegram WebApp
let tg = window.Telegram.WebApp;
tg.expand();

//âœ… Ğ‘ĞĞ—ĞĞ’Ğ«Ğ• Ğ”ĞĞĞĞ«Ğ• Ğ˜Ğ“Ğ ĞĞšĞ
let user_id = tg.initDataUnsafe?.user?.id || Math.floor(Math.random()*9999999);
let frags = 0;
let tiles = Array(9).fill("empty");
let inventory = [];

// âœ… Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ°
async function loadGame() {
  const res = await fetch(`https://my-app-space.onrender.com/game/state?user_id=${user_id}`);
  const data = await res.json();

  if(data.ok){
    frags = data.frags;
    tiles = data.farm;
    inventory = data.inventory;
  }
  openPanel('farm');
}

// âœ… Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ°
async function saveGame(){
  await fetch("https://my-app-space.onrender.com/game/save", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      user_id,
      frags,
      farm: tiles,
      inventory
    })
  });
}

// âœ… Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ Ğ¼ĞµĞ½Ñ
function openPanel(name){
  document.querySelectorAll(".panel").forEach(p=>p.classList.add("hidden"));
  document.getElementById(`panel_${name}`).classList.remove("hidden");
  if(name === "farm") renderFarm();
}

// âœ… Ñ„ĞµÑ€Ğ¼Ğ°
function renderFarm(){
  document.getElementById("user_bar").innerText = `Frags: ${frags}`;
  document.getElementById("status_bar").innerText = `Frags: ${frags}`;

  const grid = document.getElementById("farm_grid");
  grid.innerHTML = "";

  tiles.forEach((state, i)=>{
    let el = document.createElement("div");
    el.className = "tile";

    if(state === "empty") el.innerText = "Empty";
    if(state === "growing") el.innerText = "ğŸŒ±";
    if(state === "grown") el.innerText = "âœ…";

    el.onclick = ()=> clickTile(i);
    grid.appendChild(el);
  });
}

// âœ… Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° ĞºĞ»Ğ¸ĞºĞ¾Ğ²
function clickTile(i){
  if(tiles[i] === "empty"){
    tiles[i] = "growing";
    setTimeout(()=>{
      tiles[i] = "grown";
      renderFarm();
      saveGame();
    }, 2500);
  }
  else if(tiles[i] === "grown"){
    frags++;
    tiles[i] = "empty";
    renderFarm();
    saveGame();
  }
  renderFarm();
}

// âœ… Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ¸Ğ³Ñ€Ñƒ
loadGame();
</script>
</body>
</html>
